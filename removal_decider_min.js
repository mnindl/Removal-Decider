google.load("jquery","1.5.1");google.load("jqueryui","1.8.11");google.load("maps","3",{other_params:"sensor=false"});if(!window.REMOVAL){var REMOVAL={}}REMOVAL.removal_decider=(function(){var y=null;var b=null;var d=null;var v=null;var x=null;var f=null;var s=null;var o=null;var c=false;function r(){var z=new google.maps.Geocoder();$("#removal_form input:text").click(function(){$(this).removeClass("error").val("")});$("#removal_form .submit").click(function(A){A.preventDefault();$(".own_removal_data").hide();$(".removal_decider .offer").hide();$(".removal_decider .fake_datas").hide();$(".loading_animation").show();e();window.setTimeout(function(){$(".loading_animation").hide();$(".own_removal_data").show()},1000)});$(".address").autocomplete({source:function(B,A){var C={address:B.term};z.geocode(C,function(E,D){A($.map(E,function(F){if(F.formatted_address.search(/Deutschland|Schweiz|Ã–sterreich/)!==-1){return{label:F.formatted_address,value:F.formatted_address}}}))})}})}function e(){var C=$(".removal_decider .error_box");var A=new google.maps.DirectionsService();var D=$("#start").val();var z=$("#end").val();var B={origin:D,destination:z,travelMode:google.maps.DirectionsTravelMode.DRIVING};b=parseInt($("#member").val(),10);y=parseInt($("#rooms").val(),10);if(isNaN(b)||b.length===0||b===0){$("input#member").addClass("error").focus();C.find("p").html("Bitte geben Sie die richtige Anzahl der Personen an").end().fadeIn("slow");u();return false}else{if(isNaN(y)||y.length===0||y===0){$("input#rooms").addClass("error").focus();C.find("p").html("Bitte geben Sie die richtige Anzahl der R&#228;ume an").end().fadeIn("slow");u();return false}else{$("input#member, input#rooms").removeClass("error")}}A.route(B,function(E,P){if(P===google.maps.DirectionsStatus.OK){C.fadeOut();$(".error").removeClass("error");var X=E.routes[0].legs[0];$("#start").val(X.start_address);$("#end").val(X.end_address);w(X);var Q=a("removal_decider_config.json");var K=a("lkw_rent_prices.json");var F=a("stop_area_prices.json");var aa=q(X);var S=p(Q,X,y);var M=m(K,aa);var I=g(Q);var Z=parseFloat(i(Q,I));var T=h(Q,I);var U=(T==="t7"?"7,5t":"3,5t");var G=parseInt(n(K,M,T),10);var J=parseFloat(j(Q,aa,T));var O=(T==="t7"?"15l":"10l");var R=t(X,F);var N=(parseInt(R[0],10)+parseInt(R[1],10));var L=(x!==null&&f!==null?" und ":"");var Y=parseFloat(l(Q,S));var H=Z+G+J+N+Y;var W=(b>1)?" Personen":" Person";$("#header_text_member").html(b+W+" von "+d+" nach "+v);$("#header_text_distance").html("Strecke: "+aa+" km");$("#orig_distance").html(aa);$("#num_boxes i").html(I);$("#price_boxes").html(k(Z));$("#lkw_size").html(U);$("#lkw_rent_distance").html(M.toString(10));$("#lkw_rent").html(k(G));$("#fuel_price").html(k(J));$("#mileage").html(O);$("#stop_area_price").html(k(N));$("#info_stop_area_price i").html((x!==null?x:"")+L+(f!==null?f:""));if(N===0){$("#info_stop_area_price").html("Erfahrungsgem&#228;&#223; keine HVZ f&#252;r diese Orte")}$("#catering_price").html(k(Y));$("#sum .own_removal_val span").html(k(H));$("#info_catering_price #cat_member").html(b);$("#info_catering_price #cat_helper").html(Q.helper);var V=new Date();$("#fake_datas_offer_val_date").html(V.getDate()+"."+(V.getMonth()+1)+"."+V.getFullYear());$("#fake_datas_add_street").html(s);$("#fake_datas_add_region").html(o);window.setTimeout(function(){$(".removal_decider .offer").show();$(".removal_decider .fake_datas").show()},1000)}else{if(P===google.maps.DirectionsStatus.NOT_FOUND){$(".removal_decider .removal_decider_form").find("#start").addClass("error").focus().end().find("#end").addClass("error");C.find("p").html("Geben Sie bitte einen g&#252;ltigen Startort und einen g&#252;ltigen Zielort ein.").end().fadeIn("slow");u()}else{$(".removal_decider .removal_decider_form").find("#start").addClass("error").focus().end().find("#end").addClass("error");C.find("p").html("Leider liefert Google Maps kein Ergebnis zu ihrer Routenanfrage").end().fadeIn("slow");u()}}})}function w(z){d=z.start_address.split(",");if(d.length>1){if(d.length>2){s=jQuery.trim(d[0]);o=jQuery.trim(d[1])}else{s="Musterstrasse 1";o=jQuery.trim(d[0])}d=jQuery.trim(d[d.length-2].replace(/\d/g,""))}else{d=jQuery.trim(d[0])}v=z.end_address.split(",");if(v.length>1){v=jQuery.trim(v[v.length-2].replace(/\d/g,""))}else{v=jQuery.trim(v[0])}}function a(A){var z=null;$.ajax({type:"GET",url:A,dataType:"json",async:false,success:function(B){z=B}});return z}function q(A){var z=null;z=A.distance.value;z=parseInt(z/1000,10);return z}function p(G,A,F){var D=parseInt(G.drive_rest_time_in_sec,10);var B=parseInt(G.shipping_time_for_max_3_rooms_in_sec,10);var C=parseInt(G.shipping_time_for_more_3_rooms_in_sec,10);var E=parseInt(G.room_limit,10);var z=null;z=A.duration.value;z=((z+D+(F>E?C:B))/60)/60;z=Math.round(z);return z}function m(D,C){var B=[];var z=null;var A=null;$.each(D,function(E,F){B.push(E.substring(1,E.length))});$(B).each(function(){if(C<this){z=this;return false}});if(z===null){z="1000+"}return z}function g(B){var z=parseInt(B.boxes_per_room,10);var A=parseInt(B.boxes_per_member,10);return y*z+b*A}function i(B,z){var A=parseFloat(B.price_per_box);return z*A}function h(B,z){var A=parseInt(B.small_lkw_num_boxes,10);return z>A?"t7":"t3"}function n(C,B,A){var z=null;z=C["k"+B].rent[A];return z}function j(D,F,z){var B=parseFloat(D.fuel_price_liter);var E=parseFloat(D.average_fuel_consum_1_km_t3);var C=parseFloat(D.average_fuel_consum_1_km_t7);if(F<10){F=10}var A=parseInt(F*(z==="t3"?E:C),10);return A*B}function t(A,D){var z=[];var B;var C;if(D[d]!==undefined){B=D[d];x=d}else{B=0}if(D[v]!==undefined){C=D[v];f=v}else{C=0}z.push(B);z.push(C);return z}function l(E,B){var z=null;var A=parseInt(E.helper,10);var D=parseFloat(E.cat_price_1_helper);var C=A+b;z=(B)*(C*D);return z}function k(z){temp=parseInt(z*100,10);temp=temp/100;temp=temp.toFixed(2);temp=temp.replace(/\./,",");while(temp.match(/^(\d+)(\d{3}\b)/)){temp=temp.replace(/^(\d+)(\d{3}\b)/,RegExp.$1+"."+RegExp.$2)}return temp}function u(){$("#header_text_member").html("");$("#header_text_distance").html("");$("#orig_distance").html("xxx");$("#num_boxes i").html("xxx");$("#price_boxes").html("xxx");$("#lkw_size").html("xxx");$("#lkw_rent_distance").html("xxx");$("#lkw_rent").html("xxx");$("#fuel_price").html("xxx");$("#mileage").html("xxx");$("#stop_area_price").html("xxx");$("#info_stop_area_price i").html("xxx");$("#catering_price").html("xxx");$("#sum .own_removal_val span").html("xxx");$("#info_catering_price #cat_member").html("xxx");$("#info_catering_price #cat_helper").html("xxx")}return{init:function(){return r()}}}());google.setOnLoadCallback(REMOVAL.removal_decider.init);