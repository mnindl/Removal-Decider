google.load("jquery","1.5.1");google.load("jqueryui","1.8.11");google.load("maps","3",{other_params:"sensor=false"});if(!window.REMOVAL){var REMOVAL={}}REMOVAL.removal_decider=(function(){var w=null;var b=null;var c=null;var t=null;var v=null;var e=null;var r=null;var n=null;function q(){var x=new google.maps.Geocoder();$("#removal_form input:text").click(function(){$(this).removeClass("error").val("")});$("#removal_form .submit").click(function(y){y.preventDefault();d()});$(".address").autocomplete({source:function(z,y){var A={address:z.term};x.geocode(A,function(C,B){y($.map(C,function(D){if(D.formatted_address.search(/Deutschland|Schweiz|Ã–sterreich/)!==-1){return{label:D.formatted_address,value:D.formatted_address}}}))})}})}function d(){var A=$(".removal_decider .error_box");var y=new google.maps.DirectionsService();var B=$("#start").val();var x=$("#end").val();var z={origin:B,destination:x,travelMode:google.maps.DirectionsTravelMode.DRIVING};b=parseInt($("#member").val(),10);w=parseInt($("#rooms").val(),10);if(isNaN(b)||b.length===0||b===0){$("input#member").addClass("error").focus();A.find("p").html("Bitte geben Sie die richtige Anzahl der Personen an").end().fadeIn("slow");return false}else{if(isNaN(w)||w.length===0||w===0){$("input#rooms").addClass("error").focus();A.find("p").html("Bitte geben Sie die richtige Anzahl der R&#228;ume an").end().fadeIn("slow");return false}else{$("input#member, input#rooms").removeClass("error")}}y.route(z,function(C,N){if(N===google.maps.DirectionsStatus.OK){A.fadeOut();$(".error").removeClass("error");var V=C.routes[0].legs[0];$("#start").val(V.start_address);$("#end").val(V.end_address);u(V);var O=a("removal_decider_config.json");var I=a("lkw_rent_prices.json");var D=a("stop_area_prices.json");var Y=p(V);$("#orig_distance").html(Y);var Q=o(O,V,w);var K=l(I,Y);var G=f(O);$("#num_boxes i").html(G);var X=parseFloat(h(O,G));$("#price_boxes").html(j(X));var R=g(O,G);var S=(R==="t7"?"7,5t":"3,5t");$("#lkw_size").html(S);$("#lkw_rent_distance").html(K.toString(10));var E=parseInt(m(I,K,R),10);$("#lkw_rent").html(j(E));var H=parseFloat(i(O,Y,R));$("#fuel_price").html(j(H));var M=(R==="t7"?"15l":"10l");$("#mileage").html(M);var P=s(V,D);var L=(parseInt(P[0],10)+parseInt(P[1],10));$("#stop_area_price").html(j(L));var J=(v!==null&&e!==null?" und ":"");$("#info_stop_area_price i").html((v!==null?v:"")+J+(e!==null?e:""));if(L===0){$("#info_stop_area_price").html("Erfahrungsgem&#228;&#223; keine HVZ f&#252;r diese Orte")}var W=parseFloat(k(O,Q));$("#catering_price").html(j(W));var F=X+E+H+L+W;$("#sum .own_removal_val span").html(j(F));$("#info_catering_price #cat_member").html(b);$("#info_catering_price #cat_helper").html(O.helper);var U=(b>1)?" Personen":" Person";$("#header_text_member").html(b+U+" von "+c+" nach "+t);$("#header_text_distance").html("Strecke: "+Y+" km");var T=new Date();$("#fake_datas_offer_val_date").html(T.getDate()+"."+(T.getMonth()+1)+"."+T.getFullYear());$("#fake_datas_add_street").html(r);$("#fake_datas_add_region").html(n);$(".removal_decider .offer").removeClass("hidden");$(".removal_decider .fake_datas").removeClass("hidden")}else{if(N===google.maps.DirectionsStatus.NOT_FOUND){$(".removal_decider .removal_decider_form").find("#start").addClass("error").focus().end().find("#end").addClass("error");A.find("p").html("Geben Sie bitte einen g&#252;ltigen Startort und einen g&#252;ltigen Zielort ein.").end().fadeIn("slow")}else{$(".removal_decider .removal_decider_form").find("#start").addClass("error").focus().end().find("#end").addClass("error");A.find("p").html("Leider liefert Google Maps kein Ergebnis zu ihrer Routenanfrage").end().fadeIn("slow")}}})}function u(x){c=x.start_address.split(",");if(c.length>1){if(c.length>2){r=jQuery.trim(c[0]);n=jQuery.trim(c[1])}else{r="Musterstrasse 1";n=jQuery.trim(c[0])}c=jQuery.trim(c[c.length-2].replace(/\d/g,""))}else{c=jQuery.trim(c[0])}t=x.end_address.split(",");if(t.length>1){t=jQuery.trim(t[t.length-2].replace(/\d/g,""))}else{t=jQuery.trim(t[0])}}function a(y){var x=null;$.ajax({type:"GET",url:y,dataType:"json",async:false,success:function(z){x=z}});return x}function p(y){var x=null;x=y.distance.value;x=parseInt(x/1000,10);return x}function o(E,y,D){var B=parseInt(E.drive_rest_time_in_sec,10);var z=parseInt(E.shipping_time_for_max_3_rooms_in_sec,10);var A=parseInt(E.shipping_time_for_more_3_rooms_in_sec,10);var C=parseInt(E.room_limit,10);var x=null;x=y.duration.value;x=((x+B+(D>C?A:z))/60)/60;x=Math.round(x);return x}function l(B,A){var z=[];var x=null;var y=null;$.each(B,function(C,D){z.push(C.substring(1,C.length))});$(z).each(function(){if(A<this){x=this;return false}});if(x===null){x="1000+"}return x}function f(z){var x=parseInt(z.boxes_per_room,10);var y=parseInt(z.boxes_per_member,10);return w*x+b*y}function h(z,x){var y=parseFloat(z.price_per_box);return x*y}function g(z,x){var y=parseInt(z.small_lkw_num_boxes,10);return x>y?"t7":"t3"}function m(A,z,y){var x=null;x=A["k"+z].rent[y];return x}function i(B,D,x){var z=parseFloat(B.fuel_price_liter);var C=parseFloat(B.average_fuel_consum_1_km_t3);var A=parseFloat(B.average_fuel_consum_1_km_t7);if(D<10){D=10}var y=parseInt(D*(x==="t3"?C:A),10);return y*z}function s(y,B){var x=[];var z;var A;if(B[c]!==undefined){z=B[c];v=c}else{z=0}if(B[t]!==undefined){A=B[t];e=t}else{A=0}x.push(z);x.push(A);return x}function k(C,z){var x=null;var y=parseInt(C.helper,10);var B=parseFloat(C.cat_price_1_helper);var A=y+b;x=(z)*(A*B);return x}function j(x){temp=parseInt(x*100,10);temp=temp/100;temp=temp.toFixed(2);temp=temp.replace(/\./,",");while(temp.match(/^(\d+)(\d{3}\b)/)){temp=temp.replace(/^(\d+)(\d{3}\b)/,RegExp.$1+"."+RegExp.$2)}return temp}return{init:function(){return q()}}}());google.setOnLoadCallback(REMOVAL.removal_decider.init);